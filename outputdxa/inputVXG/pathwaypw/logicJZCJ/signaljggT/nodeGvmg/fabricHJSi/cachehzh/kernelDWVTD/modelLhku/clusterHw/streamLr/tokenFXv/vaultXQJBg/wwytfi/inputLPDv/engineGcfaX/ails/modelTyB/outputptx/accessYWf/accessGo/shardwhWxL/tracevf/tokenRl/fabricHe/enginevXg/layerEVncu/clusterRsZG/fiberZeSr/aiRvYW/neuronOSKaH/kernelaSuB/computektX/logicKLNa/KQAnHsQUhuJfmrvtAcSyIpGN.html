<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Securely Loading Guide</title>
  <meta name="robots" content="noindex">
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: #f9f9f9;
      color: #444;
    }
  </style>
</head>
<body>
  <div>üîê Securely loading your Guide, please wait‚Ä¶</div>

  <script type="module">
    (async () => {
      try {
        // Step 1: Call cryptograph_oneoff to get signed URL
        const res = await fetch("https://cryptograph-oneoff.shubhham-jain.workers.dev/?file=KQAnHsQUhuJfmrvtAcSyIpGN.pdf");

        if (!res.ok) {
          throw new Error("Failed to generate secure link.");
        }

        const data = await res.json();
        const signedUrl = data.signedUrl;

        // Step 2: Encode URL
        const encodedUrl = encodeURIComponent(signedUrl);

        // Step 3: Redirect to viewer with encoded URL
        const viewerUrl = `https://shubhhamjain.github.io/replit-test/database/cdn.html?file=${encodedUrl}`;
        window.location.replace(viewerUrl); // cleaner than href (no back button loop)
      } catch (err) {
        document.body.innerHTML = `<h2>‚ùå Failed to load the Guide securely.</h2><p>${err.message}</p>`;
        console.error("PDF link generation failed:", err);
      }
    })();
  </script>
</body>
</html>
