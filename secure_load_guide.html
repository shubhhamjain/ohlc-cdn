<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Securely Loading Guide</title>
  <meta name="robots" content="noindex">
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: #f9f9f9;
      color: #444;
    }
    .container {
      text-align: center;
      padding: 20px;
    }
    .loading {
      font-size: 18px;
      margin: 20px 0;
    }
    .error {
      color: #d32f2f;
      font-size: 16px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="loading" class="loading">
      üîê Securely loading your Guide, please wait..
    </div>
    
    <div id="error" class="error hidden">
      ‚ùå Failed to load the Guide securely.
    </div>
  </div>

  <script>
    // Security measures
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', function(e) {
      // Disable F12, Ctrl+Shift+I, Ctrl+U, Ctrl+S, Ctrl+P
      if (e.keyCode === 123 || 
          (e.ctrlKey && e.shiftKey && e.keyCode === 73) || 
          (e.ctrlKey && e.keyCode === 85) || 
          (e.ctrlKey && e.keyCode === 83) || 
          (e.ctrlKey && e.keyCode === 80)) {
        e.preventDefault();
        return false;
      }
    });
    
    // Disable drag and drop
    document.addEventListener('dragstart', e => e.preventDefault());
    document.addEventListener('drop', e => e.preventDefault());

    (async () => {
      try {
        // Your file ID (same as before)
        const fileId = 'OuakGZqdLSHfdmgITucteMiV.pdf';
        
        // Step 1: Get secure token from your proxy (replace with your proxy domain)
        const PROXY_DOMAIN = 'https://pdf-proxy.shubhham-jain.workers.dev/'; // Replace with your actual proxy domain
        
        const tokenResponse = await fetch(`https://${PROXY_DOMAIN}/token`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Cache-Control': 'no-cache'
          },
          body: JSON.stringify({ fileId })
        });

        if (!tokenResponse.ok) {
          throw new Error('Failed to get secure access token');
        }

        const tokenData = await tokenResponse.json();
        
        if (!tokenData.token) {
          throw new Error('Invalid token response');
        }

        // Step 2: Create clean PDF URL (no cryptograph/validatekey URLs visible)
        const cleanPdfUrl = `https://${PROXY_DOMAIN}/pdf/${fileId}?token=${tokenData.token}`;
        
        // Step 3: Encode and redirect to your PDF.js viewer
        const encodedUrl = encodeURIComponent(cleanPdfUrl);
        const viewerUrl = `https://shubhhamjain.github.io/test/database/cdn.html?file=${encodedUrl}`;
        
        // Clear URL parameters to prevent sharing
        window.history.replaceState({}, document.title, window.location.pathname);
        
        // Redirect to viewer
        window.location.replace(viewerUrl);
        
      } catch (error) {
        console.error('Secure loading failed:', error);
        
        // Show error message
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('error').classList.remove('hidden');
        
        // More detailed error message
        const errorDiv = document.getElementById('error');
        errorDiv.innerHTML = `
          <div>‚ùå Failed to load the Guide securely.</div>
          <div style="margin-top: 10px; font-size: 14px; color: #666;">
            ${error.message}
          </div>
        `;
      }
    })();
  </script>
</body>
</html>